"use strict";(self.webpackChunklearning_testing_2022_frontend=self.webpackChunklearning_testing_2022_frontend||[]).push([[343],{2343:(lt,C,a)=>{a.r(C),a.d(C,{TicketsModule:()=>at});var M=a(6977),f=a(4521),c=a(4999),T=a(3737),m=a(3075),k=a(8966),u=(()=>{return(o=u||(u={})).VERY_LOW="very_low",o.LOW="low",o.NORMAL="normal",o.HIGH="high",o.VERY_HIGH="very_high",u;var o})(),d=(()=>{return(o=d||(d={})).NEW="new",o.TO_DO="to_do",o.DESIGN="design",o.IN_PROGRESS="in_progress",o.REVIEW="review",o.TESTING="testing",o.DONE="done",o.CANCELLED="cancelled",d;var o})(),t=a(5e3),S=a(2340),O=a(520);let x=(()=>{class o{constructor(e){this.http=e,this.rootUrl=S.N.apiUrl+"/tickets"}getTickets(){return this.http.get(this.rootUrl)}getTicketById(e){return this.http.get(`${this.rootUrl}/${e}`)}createTicket(e){return this.http.post(this.rootUrl,e)}updateTicket(e,i){return this.http.patch(`${this.rootUrl}/${e}`,i)}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(O.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var A=a(6529),b=a(2290),h=a(7322),Z=a(7531),v=a(9808),D=a(4107),N=a(508),w=a(7423);function U(o,r){if(1&o&&(t.TgZ(0,"mat-error"),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.getInputErrorMessage(e.form.get("title")))}}function R(o,r){if(1&o&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.viewValue," ")}}function E(o,r){if(1&o&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.viewValue," ")}}function F(o,r){if(1&o&&(t.TgZ(0,"mat-option",17),t._uU(1),t.ALo(2,"titlecase"),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",t.lcZ(2,2,e.viewValue)," ")}}function Y(o,r){if(1&o&&(t.TgZ(0,"mat-option",17),t._uU(1),t.ALo(2,"titlecase"),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",t.lcZ(2,2,e.viewValue)," ")}}function B(o,r){if(1&o&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.viewValue," ")}}let J=(()=>{class o{constructor(e,i,n,s,p,g){this.data=e,this.dialogRef=i,this.formBuilder=n,this.ticketsService=s,this.formService=p,this.toastr=g,this.priorityOptions=this.createSelectOptionsFromStringsArray([u.VERY_LOW,u.LOW,u.NORMAL,u.HIGH,u.VERY_HIGH]),this.statusOptions=this.createSelectOptionsFromStringsArray([d.NEW,d.TO_DO,d.DESIGN,d.IN_PROGRESS,d.REVIEW,d.TESTING,d.DONE,d.CANCELLED]),this.ticketsOptions=[],this.usersOptions=[]}ngOnInit(){this.createForm(),this.ticketsOptions=this.createTicketsOptions(this.data.tickets),this.usersOptions=this.createUsersOptions(this.data.users)}get title(){return this.form.get("title")}createForm(){var e,i,n,s,p,g;const{ticket:l,authorId:st}=this.data;this.form=this.formBuilder.group({title:[null!==(e=null==l?void 0:l.title)&&void 0!==e?e:"",[m.kI.required,m.kI.minLength(5),m.kI.maxLength(200)]],authorId:[{value:st,disabled:!0}],assigneeId:[null!==(i=null==l?void 0:l.assigneeId)&&void 0!==i?i:-1],status:[{value:null!==(n=null==l?void 0:l.status)&&void 0!==n?n:this.statusOptions[0].value,disabled:!l}],priority:[null!==(s=null==l?void 0:l.priority)&&void 0!==s?s:this.priorityOptions[2].value],description:[null!==(p=null==l?void 0:l.description)&&void 0!==p?p:""],relatedTicketId:[null!==(g=null==l?void 0:l.relatedTicketId)&&void 0!==g?g:-1]})}createSelectOptionsFromStringsArray(e){const i=[];for(const n of e)i.push({value:n,viewValue:n.replace(/_/g," ")});return i}createUsersOptions(e){return[{value:-1,viewValue:"-"},...e.map(s=>({value:s.id,viewValue:s.name}))]}createTicketsOptions(e){return[{value:-1,viewValue:"-"},...e.map(s=>({value:s.id,viewValue:`LT-${s.id} ${s.title}`}))]}onSubmit(){if(this.form.invalid)return;const e=this.form.getRawValue(),{assigneeId:i,relatedTicketId:n}=e;e.assigneeId=-1===i?null:i,e.relatedTicketId=-1===n?null:n;const{ticket:s}=this.data;(s?this.ticketsService.updateTicket(+s.id,e):this.ticketsService.createTicket(e)).subscribe({next:g=>{this.onClose(),this.toastr.success(g?"The new ticket has been created":"The ticket has been updated","Success")},error:g=>{this.toastr.error("Something went wrong","Error")}})}onClose(){this.dialogRef.close()}getInputErrorMessage(e){return this.formService.getInputErrorMessage(e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(k.WI),t.Y36(k.so),t.Y36(m.qu),t.Y36(x),t.Y36(A.o),t.Y36(b._W))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-ticket-details-modal"]],decls:44,vars:8,consts:[[3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","title"],[4,"ngIf"],[1,"d-flex"],["appearance","fill",1,"flex-grow-1","me-2"],["formControlName","authorId"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill",1,"flex-grow-1"],["formControlName","assigneeId"],["formControlName","status"],["formControlName","priority"],["matInput","","formControlName","description","rows","10"],["formControlName","relatedTicketId"],["mat-dialog-actions","","align","end"],["mat-raised-button","","color","primary","type","submit",1,"mr-xs",3,"disabled"],["mat-raised-button","","type","button",3,"click"],[3,"value"]],template:function(e,i){if(1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(1,"h2"),t._uU(2,"Index details modal"),t.qZA(),t.TgZ(3,"mat-form-field",1)(4,"mat-label"),t._uU(5,"Title"),t.qZA(),t._UZ(6,"input",2),t.YNc(7,U,2,1,"mat-error",3),t.qZA(),t.TgZ(8,"section",4)(9,"mat-form-field",5)(10,"mat-label"),t._uU(11,"Author"),t.qZA(),t.TgZ(12,"mat-select",6),t.YNc(13,R,2,2,"mat-option",7),t.qZA()(),t.TgZ(14,"mat-form-field",8)(15,"mat-label"),t._uU(16,"Assignee"),t.qZA(),t.TgZ(17,"mat-select",9),t.YNc(18,E,2,2,"mat-option",7),t.qZA()()(),t.TgZ(19,"section",4)(20,"mat-form-field",5)(21,"mat-label"),t._uU(22,"Status"),t.qZA(),t.TgZ(23,"mat-select",10),t.YNc(24,F,3,4,"mat-option",7),t.qZA()(),t.TgZ(25,"mat-form-field",8)(26,"mat-label"),t._uU(27,"Priority"),t.qZA(),t.TgZ(28,"mat-select",11),t.YNc(29,Y,3,4,"mat-option",7),t.qZA()()(),t.TgZ(30,"mat-form-field",1)(31,"mat-label"),t._uU(32,"Description"),t.qZA(),t._UZ(33,"textarea",12),t.qZA(),t.TgZ(34,"mat-form-field",1)(35,"mat-label"),t._uU(36,"Related Ticket"),t.qZA(),t.TgZ(37,"mat-select",13),t.YNc(38,B,2,2,"mat-option",7),t.qZA()(),t.TgZ(39,"div",14)(40,"button",15),t._uU(41," Submit "),t.qZA(),t.TgZ(42,"button",16),t.NdJ("click",function(){return i.onClose()}),t._uU(43,"Close"),t.qZA()()()),2&e){let n;t.Q6J("formGroup",i.form),t.xp6(7),t.Q6J("ngIf",null==(n=i.form.get("title"))?null:n.invalid),t.xp6(6),t.Q6J("ngForOf",i.usersOptions),t.xp6(5),t.Q6J("ngForOf",i.usersOptions),t.xp6(6),t.Q6J("ngForOf",i.statusOptions),t.xp6(5),t.Q6J("ngForOf",i.priorityOptions),t.xp6(9),t.Q6J("ngForOf",i.ticketsOptions),t.xp6(2),t.Q6J("disabled",i.form.invalid)}},directives:[m._Y,m.JL,m.sg,h.KE,h.hX,Z.Nt,m.Fj,m.JJ,m.u,v.O5,h.TO,D.gD,v.sg,N.ey,k.H8,w.lW],pipes:[v.rS],styles:["mat-form-field[_ngcontent-%COMP%]{display:block}.mat-form-field[_ngcontent-%COMP%]{margin-bottom:0rem}.mr-xs[_ngcontent-%COMP%]{margin-right:.5rem}"]}),o})();var I=a(6087);function P(o,r){if(1&o&&(t.TgZ(0,"th",14),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e," ")}}function L(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"td",15),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).updateTicket(s.id)}),t._uU(1),t.qZA()}if(2&o){const e=r.$implicit,i=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.hij(" ",n.getTableCellValue(i,e[i])," ")}}function $(o,r){1&o&&(t.ynx(0,11),t.YNc(1,P,2,1,"th",12),t.YNc(2,L,2,1,"td",13),t.BQk()),2&o&&t.s9C("matColumnDef",r.$implicit)}function Q(o,r){1&o&&t._UZ(0,"tr",16)}function V(o,r){1&o&&t._UZ(0,"tr",17)}function G(o,r){if(1&o&&(t.TgZ(0,"tr",18)(1,"td",19),t._uU(2),t.qZA()()),2&o){t.oxw();const e=t.MAs(8);t.xp6(2),t.hij('No data matching the filter "',e.value,'"')}}const z=function(){return[5,10,25,100]};let H=(()=>{class o{constructor(e,i,n,s,p){this.http=e,this.route=i,this.dialog=n,this.ticketsService=s,this.toastr=p,this.title="learning-testing-2022-frontend",this.ticketsDataSource=new c.by,this.tickets=[],this.ticketsColumns=["id","title","status","priority"],this.users=[]}ngOnInit(){}ngAfterViewInit(){this.getTickets(),this.getUsers()}getTickets(){this.route.data.subscribe(({tickets:e})=>{this.tickets=e,this.ticketsDataSource=new c.by(this.tickets),this.ticketsDataSource.paginator=this.paginator})}reloadTickets(){this.ticketsService.getTickets().subscribe({next:e=>{this.tickets=e,this.ticketsDataSource.data=this.tickets},error:e=>{this.toastr.error("Reloading tickets failed","Error")}})}getUsers(){this.route.data.subscribe(({users:e,signedInUserId:i})=>{this.users=e,this.signedInUserId=i})}getTableCellValue(e,i){return"id"===e?`LT-${i}`:i}calculateTicketsPositions(){this.tickets.map((e,i)=>(e.position=i+1,e))}applyFilter(e){this.ticketsDataSource.filter=e.target.value.trim().toLowerCase()}drop(e){(0,T.bA)(this.tickets,e.previousIndex,e.currentIndex),this.calculateTicketsPositions(),this.ticketsDataSource.data=this.tickets}createNewTicket(){this.openTicketModal({tickets:this.tickets,users:this.users,authorId:this.signedInUserId})}updateTicket(e){this.ticketsService.getTicketById(e).subscribe({next:i=>{this.openTicketModal({tickets:this.tickets,users:this.users,ticket:i,authorId:i.authorId})},error:i=>{this.toastr.error("Something went wrong","Error")}})}openTicketModal(e){this.dialog.open(J,{width:"700px",data:e,disableClose:!1}).afterClosed().subscribe(n=>{console.log(`The dialog was closed. Result: ${n}`),this.reloadTickets()})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(O.eN),t.Y36(f.gz),t.Y36(k.uw),t.Y36(x),t.Y36(b._W))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-backlog"]],viewQuery:function(e,i){if(1&e&&t.Gf(I.NW,5),2&e){let n;t.iGM(n=t.CRH())&&(i.paginator=n.first)}},decls:16,vars:7,consts:[["mat-raised-button","",3,"click"],["appearance","standard"],["matInput","","placeholder","Searched term",3,"keyup"],["input",""],[1,"mat-elevation-z8"],["mat-table","","multiTemplateDataRows","","cdkDropList","",3,"dataSource","cdkDropListDropped"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","example-element-row","cdkDrag","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of tickets",3,"pageSizeOptions"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",3,"click",4,"matCellDef"],["mat-header-cell",""],["mat-cell","",3,"click"],["mat-header-row",""],["mat-row","","cdkDrag","",1,"example-element-row"],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,i){1&e&&(t.TgZ(0,"h2"),t._uU(1,"Tickets"),t.qZA(),t.TgZ(2,"button",0),t.NdJ("click",function(){return i.createNewTicket()}),t._uU(3,"Create ticket"),t.qZA(),t.TgZ(4,"mat-form-field",1)(5,"mat-label"),t._uU(6,"Filter"),t.qZA(),t.TgZ(7,"input",2,3),t.NdJ("keyup",function(s){return i.applyFilter(s)}),t.qZA()(),t.TgZ(9,"div",4)(10,"table",5),t.NdJ("cdkDropListDropped",function(s){return i.drop(s)}),t.YNc(11,$,3,1,"ng-container",6),t.YNc(12,Q,1,0,"tr",7),t.YNc(13,V,1,0,"tr",8),t.YNc(14,G,3,1,"tr",9),t.qZA(),t._UZ(15,"mat-paginator",10),t.qZA()),2&e&&(t.xp6(10),t.Q6J("dataSource",i.ticketsDataSource),t.xp6(1),t.Q6J("ngForOf",i.ticketsColumns),t.xp6(1),t.Q6J("matHeaderRowDef",i.ticketsColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.ticketsColumns),t.xp6(2),t.Q6J("pageSizeOptions",t.DdM(6,z)))},directives:[w.lW,h.KE,h.hX,Z.Nt,c.BZ,T.Wj,v.sg,c.w1,c.fO,c.ge,c.Dz,c.ev,c.as,c.XQ,c.nj,c.Gk,T.Zt,c.Ee,I.NW],styles:["table[_ngcontent-%COMP%]{width:100%}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{width:25%}tr.example-detail-row[_ngcontent-%COMP%]{height:0}tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:whitesmoke}tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:#efefef}.example-element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}.example-element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column}.example-element-diagram[_ngcontent-%COMP%]{min-width:80px;border:2px solid black;padding:8px;font-weight:lighter;margin:8px 0;height:104px}.example-element-symbol[_ngcontent-%COMP%]{font-weight:700;font-size:40px;line-height:normal}.example-element-description[_ngcontent-%COMP%]{padding:16px}.example-element-description-attribution[_ngcontent-%COMP%]{opacity:.5}.mat-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}.example-list[_ngcontent-%COMP%]{width:500px;max-width:100%;border:solid 1px #ccc;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden}.example-box[_ngcontent-%COMP%]{padding:20px 10px;border-bottom:solid 1px #ccc;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:move;background:white;font-size:14px}.example-box.cdk-drag-disabled[_ngcontent-%COMP%]{background:#ccc;cursor:default}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .example-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),o})(),W=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-board"]],decls:2,vars:0,template:function(e,i){1&e&&(t.TgZ(0,"p"),t._uU(1,"board works!"),t.qZA())},styles:[""]}),o})();var y=a(7785);let j=(()=>{class o{constructor(e){this.ticketsService=e}resolve(e,i){return this.ticketsService.getTickets()}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(x))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var q=a(9086),X=a(5698),K=a(4004),tt=a(262),et=a(2843),ot=a(2783);const nt=[{path:"",pathMatch:"full",canActivate:[y.a],component:H,resolve:{signedInUserId:(()=>{class o{constructor(e,i){this.authService=e,this.router=i}resolve(e,i){return this.authService.signedInUser$.pipe((0,X.q)(1),(0,K.U)(n=>{if(!n||!n.id)throw new Error("No user is signed-in");return n.id}),(0,tt.K)(n=>(this.router.navigateByUrl("/signin"),(0,et._)(n))))}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(ot.e),t.LFG(f.F0))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),tickets:j,users:q.o}},{path:"board",canActivate:[y.a],component:W}];let rt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[f.Bz.forChild(nt)],f.Bz]}),o})(),at=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[M.m,rt]]}),o})()}}]);